# 实验分析

- ### 参数列表

  在进行分析前，先介绍一下这个模型涉及到的一些参数。本模型的参数主要分为两个部分：一个是数据预处理部分，一个是Seq2Seq模型部分。

  - **数据预处理部分**

    这部分的参数都在`SogouNews`这个类里面，作用如下：

    | 参数名       | 作用                                                         |
    | ------------ | ------------------------------------------------------------ |
    | `file_name:` | 指定载入数据集的名称；                                       |
    | `len_words:` | 指定分词后根据词长度筛选的条件，默认为1，也就是即使是一个字也会考虑； |
    | `freq:`      | 指定词频统计后根据词频过滤词的条件，默认为10，即出现次数小于10的将去掉； |
    | `top_words:` | 指定字典长度，默认为2万，即只选词频靠前的2万个词构成字典，当`freq>0`时，该参数无效； |
  
  - **模型部分**
  
    这部分的参数都在`Seq2Seq`这个类里面，作用如下：
  
    | 参数名            | 作用                                                         |
    | ----------------- | ------------------------------------------------------------ |
    | `truncate_times:` | 指定截取长度倍数；由于通常情况下不同新闻的长度相差很大，并且新闻标题得出并不一定要依靠所有新闻，为了提高训练速度，本模型加入了该参数，只从新闻内容中截取标题长度的`truncate_times`作为标签来训练； |
    | `rnn_size:`       | 指定编码解码部分rnn的维度；                                  |
    | `rnn_layer:`      | 指定编码解码部分rnn的层数；                                  |
    | `share_vocab:`    | 指定编码和解码部分是否共用词向量，通常在翻译模型中由于编码和解码部分的语言不同所以必须使用不同的词向量表示，但是在本模型中可以不同也可相同，模型相同； |
    | `src_vocab_size:` | 指定编码部分词表长度，实质上该参数是由字典的大小决定的，不用指定； |
    | `tgt_vocab_size:` | 指定解码部分词表长度，实质上该参数是由字典的大小决定的，不用指定； |
    | `src_embed_size:` | 指定编码部分词向量的维度；                                   |
    | `tgt_embed_size:` | 指定解码部分词向量的维度；                                   |
    | `use_attention:`  | 指定是否使用注意力机制，默认不使用；                         |
    | `inference:`      | 指定当前为训练还是预测阶段；                                 |
    | `model_path:`     | 指定模型保存路径，默认为`MODEL`，训练好的模型会保存到该文件夹下； |
    | `log_dir:`        | 指定训练输出日志的文件名，默认为`log_train`；                |

- ### **参数分析**

  - **结果一：bleu = 10.69**

    | 参数值                  | 实验效果（训练:预测  5 VS 5)                                 |
    | ----------------------- | ------------------------------------------------------------ |
    | `len_words = 1`         | 标签值：天宫 一号 与 神舟 九号 24 日 实施 手控 交会 对接<br>预测值：天宫 一号 与 神舟 九号 成功 日 完成 手控 交会 对接 |
    | `freq = 20`             | 标签值：苏州 有毒气体 泄漏 事件 原因 查明 重伤 者 仍 在 救治<br/>预测值：江苏 有毒气体 泄漏 事件 致 查明 重伤 者 仍 未 救治 |
    | `rnn_size = 128`        | 标签值：拾荒 妇女 出租屋 内 离世<br/>预测值：男子 男子 被 被 被 |
    | `rnn_layer = 2`         | 标签值：上半年 山东省 就业 形势 平稳<br/>预测值：就业 城镇 城镇居民 增长 良好 |
    | `truncate_times = 15`   | 标签值：辽宁 推动 大小 企业 组建 联合体 共享 政府 采购<br/>预测值：国家 将 商贸 公司 签署 分公司 与 政府 采购 |
    | `share_vocab = True`    | 真实标签： 民政部社会福利和慈善事业促进司<br/>预测标签： 注册会计师作品年会举行 |
    | `src_embed_size = 128`  | 真实标签： 壹基金救援联盟备战水灾展开公益救援演习<br/>预测标签： 陇原最大规模红色活动昨晚举行 |
    | `learning_rate = 1e-3`  | 真实标签： 调查:你认可在自动提款机上设置捐赠选项吗?<br/>预测标签： 英国银行电击月内救助七天手机<UNK>善款 |
    | `use_attention = False` | 真实标签： 出租车燃油费跟涨不跟跌 全国仅有11个城市下调<br/>预测标签： 出租车燃油附加费下调五万以内多便宜元 |
    | `batch_size = 128`      | 真实标签： 「为何慈善机制落后于热情?」<br/>预测标签： 共同努力在香港高等教育的发展 |

    在`len_words = 1,freq = 20`时：

    1.样本总数为:1207536<br>
    2.整个数据一共包含343180430个词语<br>
    3.整个数据一共包含1952639个不同的词语<br>
    4.按指定条件筛选后，整个数据还包含234713个不同的词语！<br>

    第一次数据预处理约要50分钟，数据训练时长约54小时，26轮迭代，模型下载地址：[MODEL_00]
    
    
    
  - **结果二： blue = 9.23**
  
    | 参数值                  | 实验效果（训练:预测  5 VS 5)                                 |
    | ----------------------- | ------------------------------------------------------------ |
    | `len_words = 1`         | 标签值：天宫 一号 与 神舟 九号 24 日 实施 手控 交会 对接 <br>预测值：天宫 一号 与 神舟 九号 成功 日 完成 手控 交会 对接 |
    | `freq = 20`             | 标签值：苏州 有毒气体 泄漏 事件 原因 查明 重伤 者 仍 在 救治<br/>预测值：苏州 有毒气体 泄漏 事件 原因 查明 重伤 者 仍 在 救治 |
    | `rnn_size = 200`        | 标签值：拾荒 妇女 出租屋 内 离世<br/>预测值：荒 妇女 出租屋 大火 离世 |
    | `rnn_layer = 2`         | 标签值：上半年 山东省 就业 形势 平稳 <br/>预测值：上半年 我省 就业 形势 平稳 运行 |
    | `truncate_times = 15`   | 标签值：辽宁 推动 大小 企业 组建 联合体 共享 政府 采购 <br/>预测值：辽宁 推动 大小 企业 组建 联合体 共享 政府 采购 |
    | `share_vocab = True`    | 真实标签： 民政部社会福利和慈善事业促进司 <br/>预测标签： 2012读书<UNK>启动 |
    | `src_embed_size = 200`  | 真实标签： 壹基金救援联盟备战水灾展开公益救援演习 <br/>预测标签： 承办壹保险主题电话:大漠战斗:英国用户体验严阵以待安保 |
    | `learning_rate = 1e-3`  | 真实标签： 调查:你认可在自动提款机上设置捐赠选项吗? <br/>预测标签： 英夫妇玩裸照电话“蒸发”银行理财被判3年 |
    | `use_attention = False` | 真实标签： 出租车燃油费跟涨不跟跌 全国仅有11个城市下调 <br/>预测标签： 出租车燃油费周一下调不跟涨不跟跌城市主力军(图) |
    | `batch_size = 64`       | 真实标签： 「为何慈善机制落后于热情?」 <br/>预测标签： 中国慈善评述生活是日本的安全感 |
  
    这次测试由于`len_words`和`freq`这两个参数没变，所以数据预处理部分直接载入之前处理好的；此次训练加大了词向量的维度，不过最后一次模型在预测部分的效果居然还不如之前，只是在训练过程中的推断部分稍好于前一次。本次训练历时5天又5小时，40轮迭代。
    
    
    
  - **结果三：blue=22.73 **
  
    | 参数值                 | 实验效果（训练:预测  5 VS 5)                                 |
    | ---------------------- | ------------------------------------------------------------ |
    | `len_words = 1`        | 标签值：天宫 一号 与 神舟 九号 24 日 实施 手控 交会 对接  <br/>预测值：天宫 一号 与 神舟 九号 24 日 实施 手控 交会 对接 |
    | `freq = 20`            | 标签值：苏州 有毒气体 泄漏 事件 原因 查明 重伤 者 仍 在 救治 <br/>预测值：苏州 有毒气体 泄漏 事件 原因 查明 重伤 者 仍 在 救治 |
    | `rnn_size = 128`       | 标签值：拾荒 妇女 出租屋 内 离世 <br/>预测值：               |
    | `rnn_layer = 2`        | 标签值：上半年 山东省 就业 形势 平稳  <br/>预测值：上半年 我省 就业 形势 平稳 运行 |
    | `truncate_times = 15`  | 标签值：辽宁 推动 大小 企业 组建 联合体 共享 政府 采购  <br/>预测值：辽宁 推动 大小 企业 组建 联合体 共享 政府 采购 |
    | `share_vocab = True`   | 真实标签： 民政部社会福利和慈善事业促进司  <br/>预测标签： 2010年公益信息化创新促进公益事业 |
    | `src_embed_size = 128` | 真实标签： 壹基金救援联盟备战水灾展开公益救援演习  <br/>预测标签： 30小时应急救援直播 |
    | `learning_rate = 1e-3` | 真实标签： 调查:你认可在自动提款机上设置捐赠选项吗?  <br/>预测标签： 英民众用保护提款机的捐赠意识已保证捐赠 |
    | `use_attention = True` | 真实标签： 出租车燃油费跟涨不跟跌 全国仅有11个城市下调  <br/>预测标签： 出租车燃油费跟涨不跟跌出租车燃油费跟涨不跟跌(组图) |
    | `batch_size =128`      | 真实标签： 「为何慈善机制落后于热情?」  <br/>预测标签： 那些年我们如何让平民慈善的养老人生 |
  
    这次测试由于`len_words`和`freq`这两个参数没变，所以数据预处理部分直接载入之前处理好的；此次训练同结果一相比较仅仅只是加入了注意力机制，但最后在测试集上的表现却是好了已被多，足见注意力的重要性。同时，在训练过程中的推断结果，几乎能够正确样本保持一致。本次训练历时近4天，50轮迭代。